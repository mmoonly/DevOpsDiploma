# DevOps Diploma Project

This repository contains the **DevOpsDiploma** project, a comprehensive demonstration of DevOps practices applied to a Java-based microservices application. The project leverages **Infrastructure as Code (IaC)** with Ansible, a robust **CI/CD pipeline** powered by Jenkins, and a monitoring and logging stack using Prometheus, Grafana, Alertmanager, and the ELK Stack (Elasticsearch, Logstash, Kibana, Filebeat).

## Project Structure

- **`ansible/`**: Contains Ansible playbooks, roles, and inventory for infrastructure management.
  - **`ansible.cfg`**: Configuration file with disabled host key checking and `ubuntu` as the default user.
  - **`inventories/`**:
    - **`group_vars/all.yml`**: Centralized variable definitions for all hosts.
    - **`hosts.yml`**: Inventory file listing servers and their connection details.
  - **`playbooks/setup.yml`**: Main playbook for orchestrating infrastructure deployment.
  - **`roles/`**: Modular roles for services (e.g., `alertmanager`, `prometheus`), each containing `tasks/`, `templates/`, and other resources.
- **`ci/`**: Stores `jenkins_home_prepared.tar.gz`, excluded from version control via `.gitignore`.
- **`java-app/`**: Java application source code and containerization configuration.
  - **`Dockerfile`**: Defines the container build process.
  - **`pom.xml`**: Maven configuration for dependency management and builds.
  - **`src/`**: Application source code and tests.
  - **`target/`**: Build artifacts generated by Maven.
- **`Jenkinsfile`**: Defines the CI/CD pipeline for automated builds and deployments.
- **`README.md`**: This documentation file.
- **`vault_pass.txt`**: Stores the Ansible Vault password for decrypting `ansible/vars/secrets.yml`.
- **`.gitignore`**: Excludes sensitive files and directories from version control.

## Prerequisites

To deploy and run this project, ensure you have:
- Ubuntu 24.04 (or a compatible Linux distribution).
- Docker and Docker Compose installed.
- Java 21 and Maven for building the application.
- Git for cloning the repository.
- Ansible for infrastructure provisioning.

## Installation and Setup

### 1. Clone the Repository
```bash
git clone https://github.com/mmoonly/DevOpsDiploma.git
cd DevOpsDiploma
```

### 2. Configure Ansible Vault
- Ensure `vault_pass.txt` contains the password for decrypting `ansible/vars/secrets/secrets.yml`.
- Run the playbook:
  ```bash
  ANSIBLE_VAULT_PASSWORD_FILE=vault_pass.txt ansible-playbook -i ansible/inventories/hosts.yml ansible/playbooks/setup.yml
  ```

### 3. Update Inventory
- Modify `ansible/inventories/hosts.yml` to include your server IPs and SSH key paths. Example:
  ```yaml
  all:
    children:
      jenkins:
        hosts:
          jenkins_server:
            ansible_host: 192.168.100.15
            ansible_user: ubuntu
            ansible_ssh_private_key_file: ~/.ssh/id_rsa
      app:
        hosts:
          app_server:
            ansible_host: 192.168.100.13
            ansible_user: ubuntu
            ansible_ssh_private_key_file: ~/.ssh/id_rsa
      monitoring:
        hosts:
          monitoring_server:
            ansible_host: 192.168.100.14
            ansible_user: ubuntu
            ansible_ssh_private_key_file: ~/.ssh/id_rsa
  ```

### 4. Deploy the Infrastructure
- Execute the playbook to provision the infrastructure:
  ```bash
  ANSIBLE_VAULT_PASSWORD_FILE=vault_pass.txt ansible-playbook -i ansible/inventories/hosts.yml ansible/playbooks/setup.yml
  ```

### 5. Configure Jenkins CI/CD
- Access Jenkins at `http://192.168.100.15:8080`.
- Configure credentials in Jenkins for:
  - `docker-creds`: Docker Hub authentication.
  - `jenkins-to-app-ssh`: SSH key for app server deployment.
  - `telegram-bot-token`: Telegram bot token for notifications.
  - `telegram-chat-id`: Telegram chat ID for notifications.
- The `Jenkinsfile` triggers builds every 2 minutes via `pollSCM('H/2 * * * *')`.

## Service Roles

The project includes Ansible roles for deploying and managing various services:

| Role             | Version       | Port  | Config Path                    | Data Path                      | Behavior                                                                 |
|------------------|---------------|-------|--------------------------------|--------------------------------|--------------------------------------------------------------------------|
| **alertmanager** | `latest`      | 9093  | `/data/alertmanager/configs`   | `/data/alertmanager/data`      | Resets if `alertmanager_flush=true`; deploys and configures if `false`.   |
| **elasticsearch**| `9.0.3`       | 9200  | `/data/elk/configs/elasticsearch` | `/data/elk/elasticsearch` | Resets if `elasticsearch_flush=true`; deploys and runs if `false`.        |
| **filebeat**     | `9.0.3`       | -     | `/data/elk/configs/filebeat`   | -                              | Resets logs if `filebeat_flush=true`; collects logs if `false`.           |
| **grafana**      | `latest`      | 3000  | `/data/grafana/configs`        | `/data/grafana/data`           | Resets if `grafana_flush=true`; deploys dashboards if `false`.            |
| **jenkins**      | `lts-jdk21`   | 8080  | `/opt/jenkins_home`            | -                              | Resets if `jenkins_flush=true`; deploys Java/Maven and runs if `false`.   |
| **kibana**       | `9.0.3`       | 5601  | `/data/elk/configs/kibana`     | `/data/elk/kibana`             | Resets if `kibana_flush=true`; deploys and visualizes if `false`.         |
| **logstash**     | `9.0.3`       | 5044  | `/data/elk/configs/logstash`   | `/data/elk/logstash`           | Resets if `logstash_flush=true`; deploys and filters logs if `false`.     |
| **node-exporter**| `latest`      | 9100  | -                              | -                              | Resets if `node_exporter_flush=true`; deploys metrics if `false`.         |
| **prometheus**   | `latest`      | 9090  | `/data/prometheus/configs`     | `/data/prometheus/data`        | Resets if `prometheus_flush=true`; deploys and monitors if `false`.       |

## CI/CD Pipeline

The Jenkins pipeline automates the build and deployment process with the following stages:
- **Checkout**: Clones the repository and updates submodules.
- **Lint**: Runs Checkstyle to enforce coding standards.
- **Build**: Compiles the application using Maven.
- **Test**: Executes unit tests.
- **Archive Artifacts**: Stores the compiled `.jar` file.
- **Docker Build & Push**: Builds and pushes the Docker image to Docker Hub.
- **Deploy to App Server**: Deploys the application to `192.168.100.13:8080`.
- **Notify**: Sends build status notifications via Telegram.

The pipeline is triggered every 2 minutes with `pollSCM('H/2 * * * *')`.

## Monitoring and Logging

The project includes a robust monitoring and logging stack:
- **Prometheus**: Collects metrics from `node-exporter` at `http://192.168.100.14:9090`.
- **Alertmanager**: Sends alerts to Telegram on port `9093`.
- **Grafana**: Provides dashboards at `http://192.168.100.14:3000`.
- **ELK Stack**:
  - **Elasticsearch**: Stores logs at `http://192.168.100.14:9200`.
  - **Logstash**: Processes logs on port `5044`.
  - **Kibana**: Visualizes logs at `http://192.168.100.14:5601`.
  - **Filebeat**: Collects logs from `/var/log`.

## Tools Used

- **IaC**: Ansible for infrastructure provisioning.
- **CI/CD**: Jenkins for pipeline automation.
- **Monitoring**: Prometheus, Grafana, Alertmanager, Node Exporter.
- **Logging**: ELK Stack (Elasticsearch, Logstash, Kibana, Filebeat).
- **Application**: Java application built with Maven.

## Project Status

- Infrastructure provisioning is fully functional.
- CI/CD pipeline is operational and actively used.
- Monitoring and logging systems are deployed and ready for testing.


